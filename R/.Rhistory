par(mfrow=c(2,2))
mosaicplot(pet~fish,dades)
mosaicplot(camper~fish,dades)
mosaicplot(persons~fish,dades)
mosaicplot(child~fish,dades)
# Descriptiva de recomptes
boxplot(log(count+0.1)~pet,dades)
boxplot(log(count+0.1)~camper,dades)
boxplot(log(count+0.1)~persons,dades)
boxplot(log(count+0.1)~child,dades)
# include =FALSE
# Descriptiva interna --> No s'executa
plot(persons~child,dades,main='Persons vs. Child') # verificar que els nens estan inclosos a les persones
# Descriptiva de binari
par(mfrow=c(2,2))
mosaicplot(pet~fish,dades)
mosaicplot(camper~fish,dades)
mosaicplot(persons~fish,dades)
mosaicplot(child~fish,dades)
# Descriptiva de recomptes
boxplot(log(count+0.1)~pet,dades)
boxplot(log(count+0.1)~camper,dades)
boxplot(log(count+0.1)~persons,dades)
boxplot(log(count+0.1)~child,dades)
tb1 <- as.data.frame(with(dades,table(camper,fish)))
tb2 <- data.frame(Model=c('Logit','Probit','Cloglog'),
"Intercept (b0)"=rep('',3),
"Coeficient camper (b1)"=rep('',3))
tb1k <- kable(tb1, format = "latex", booktabs = TRUE)
tb2k <- kable(tb2, format = "latex", booktabs = TRUE,
col.names = c('Model','Intercept (b0)','Coeficient camper (b1)'),
linesep = c('\\hline')) %>%  kable_styling(full_width = TRUE) # \\addlinespace \\addlinespace
kable(tb1) %>%  kable_styling(full_width = TRUE)
# Load libraries  -------------------------
library(knitr)     # kable
library(car)       # residualPlots
library(kableExtra)# Taules amb format
library(emmeans)   # Summary
library(gridExtra) # Varios gràfics ggplot en 1
library(ggplot2)   # Gràfics
library(pROC)      # Corba ROC
library(AER)       # dispersion.test
library(devtools)
# devtools::install_github("rforge/countreg/pkg")
suppressMessages(library(countreg)) # zeroinfl
# Opcions knitr  -------------------------
options(knitr.kable.NA = '')                # NA com blancs a les taules
# Per poder modificar la grandaria de la font dels chunks
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
x <- def.chunk.hook(x, options)
ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
#######################################################
#                 Mostrar solució                     #
#######################################################
show.sol <- TRUE
# Llegir les dades -------------------------
zinb <- read.csv("https://stats.idre.ucla.edu/stat/data/fish.csv") # read data
dades <- zinb[,c("livebait","camper","persons","child","count")]
dades$fish <- ifelse(dades$count==0,0,1)
dades$pet <- factor(dades$livebait)
dades$camper <- factor(dades$camper)
dades$livebait <- NULL
# include =FALSE
# Descriptiva interna --> No s'executa
plot(persons~child,dades,main='Persons vs. Child') # verificar que els nens estan inclosos a les persones
# Descriptiva de binari
par(mfrow=c(2,2))
mosaicplot(pet~fish,dades)
mosaicplot(camper~fish,dades)
mosaicplot(persons~fish,dades)
mosaicplot(child~fish,dades)
# Descriptiva de recomptes
boxplot(log(count+0.1)~pet,dades)
boxplot(log(count+0.1)~camper,dades)
boxplot(log(count+0.1)~persons,dades)
boxplot(log(count+0.1)~child,dades)
##-- Logit
odd_no_camper <- tb1$Freq[tb1$camper==0 & tb1$fish==1]/tb1$Freq[tb1$camper==0 & tb1$fish==0]
odd_no_camper
(modb1_b0 <- log(odd_no_camper))
(modb1_b0 <- log(odd_no_camper))
(modb1_b1 <- log(odd_camper) - log(odd_no_camper))
odd_no_camper <- tb1$Freq[tb1$camper==0 & tb1$fish==1]/tb1$Freq[tb1$camper==0 & tb1$fish==0]
odd_camper <- tb1$Freq[tb1$camper==1 & tb1$fish==1]/tb1$Freq[tb1$camper==1 & tb1$fish==0]
(modb1_b0 <- log(odd_no_camper))
(modb1_b1 <- log(odd_camper) - log(odd_no_camper)) #
modb1 <- glm(fish~camper,dades,family=binomial)
modb1
p_no_camper <- tb1$Freq[tb1$camper==0 & tb1$fish==1]/sum(tb1$Freq[tb1$camper==0])
p_camper <- tb1$Freq[tb1$camper==1 & tb1$fish==1]/sum(tb1$Freq[tb1$camper==1])
(modb2_b0 <- qnorm(p_no_camper))
(modb2_b1 <- qnorm(p_camper) - qnorm(p_no_camper))
##-- Logit
odd_no_camper <- tb1$Freq[tb1$camper==0 & tb1$fish==1]/tb1$Freq[tb1$camper==0 & tb1$fish==0]
odd_camper <- tb1$Freq[tb1$camper==1 & tb1$fish==1]/tb1$Freq[tb1$camper==1 & tb1$fish==0]
(modb1_b0 <- log(odd_no_camper))
(modb1_b1 <- log(odd_camper) - log(odd_no_camper)) # = log(odd_camper) - modb1_b0
##-- Probit
p_no_camper <- tb1$Freq[tb1$camper==0 & tb1$fish==1]/sum(tb1$Freq[tb1$camper==0])
p_camper <- tb1$Freq[tb1$camper==1 & tb1$fish==1]/sum(tb1$Freq[tb1$camper==1])
(modb2_b0 <- qnorm(p_no_camper))
(modb2_b1 <- qnorm(p_camper) - qnorm(p_no_camper))
##-- cloglog
(modb3_b0 <- log(log(1/(1-p_no_camper))))
(modb3_b1 <- log(log(1/(1-p_camper))) - modb3_b0)
modb1 <- glm(fish~camper,dades,family=binomial)
modb2 <- glm(fish~camper,dades,family=binomial(link = 'probit'))
modb3 <- glm(fish~camper,dades,family=binomial(link = 'cloglog'))
modb1
modb2
modb3
y00 <- tb1$Freq[tb1$camper==0 & tb1$fish==0]
y01 <- tb1$Freq[tb1$camper==0 & tb1$fish==1]
y10 <- tb1$Freq[tb1$camper==1 & tb1$fish==0]
y11 <- tb1$Freq[tb1$camper==1 & tb1$fish==1]
y <- c(y00,y01,y10,y11)
y
p_0 <- sum(tb1$Freq[tb1$fish==0])/sum(tb1$Freq)
p_1 <- sum(tb1$Freq[tb1$fish==1])/sum(tb1$Fre
p_0
p_0 <- sum(tb1$Freq[tb1$fish==0])/sum(tb1$Freq)
p_1 <- sum(tb1$Freq[tb1$fish==1])/sum(tb1$Freq)
p_0
p_1
e00 <- sum(tb1$Freq[tb1$camper==0])*p_0
e00
sum(tb1$Freq[tb1$camper==0])*p_1
e01
e01 <- sum(tb1$Freq[tb1$camper==0])*p_1
e01
e10 <- sum(tb1$Freq[tb1$camper==1])*p_0
e11 <- sum(tb1$Freq[tb1$camper==1])*p_1
e <- c(e00,e01,e10,e11)
e
# Deviança model nul
D <- 2 * sum(y*log(y/e))
D
cat(' Deviança:',D,'\n',
'Punt crític:',qchisq(0.95,1),'\n',
'Tenir caravana té una associació significativa amb la probabilitat de pescar')
tb3 <- addmargins(as.table(matrix(c(71,16,71,92),nrow=2,byrow = TRUE,dimnames = list(Predictions=c('PR-','PR+'),
Observed=c('FISH-','FISH+')))))
kable(tb3)
mod.poi1 <- glm(count~camper + pet + child + persons,dades,family=poisson)
mod.poi2 <- glm(count~camper + pet + child + offset(persons),dades,family=poisson)
mod.zip <- zeroinfl(count~camper + pet + child + persons,data=dades,dist = 'poisson')
summary(mod.zip)
library(data.table)
dades <- as.data.table(dades)
dades_freq <- dades[,.(Freq=sum(count)),by=.(camper, pet, persons)]
dades_freq$persons <- factor(dades_freq$persons)
# Additiu
modm1 <- glm(Freq~ camper + pet + persons,dades_freq,family=poisson)
# 1 interacció
modm2 <- glm(Freq~ camper * pet + persons,dades_freq,family=poisson)
modm3 <- glm(Freq~ camper * persons + pet,dades_freq,family=poisson)
modm4 <- glm(Freq~ camper + pet * persons,dades_freq,family=poisson)
# 2 interaccións
modm5 <- glm(Freq~ camper * (pet + persons),dades_freq,family=poisson)
modm6 <- glm(Freq~ pet * (camper + persons),dades_freq,family=poisson)
modm7 <- glm(Freq~ persons * (camper + pet),dades_freq,family=poisson)
# 3 interaccions
modm8 <- glm(Freq~ (camper + pet + persons)^2,dades_freq,family=poisson)
# Totes
modm9 <- glm(Freq~ camper * pet * persons,dades_freq,family=poisson)
df <- data.frame(Model=1:9,
Formula= as.character(c(modm1$formula,modm2$formula,modm3$formula,
modm4$formula,modm5$formula,modm6$formula,
modm7$formula,modm8$formula,modm9$formula)),
Deviance=round(c(modm1$dev,modm2$dev,modm3$dev,
modm4$dev,modm5$dev,modm6$dev,
modm7$dev,modm8$dev,modm9$dev),2),
Gll=c(modm1$df.res,modm2$df.res,modm3$df.res,
modm4$df.res,modm5$df.res,modm6$df.res,
modm7$df.res,modm8$df.res,modm9$df.res))
df$dif <- NA
df$dif[2:4] <- df$Deviance[1] - df$Deviance[2:4]
df$dif[5:7] <- df$Deviance[3] - df$Deviance[5:7]
df$dif[8] <- df$Deviance[5] - df$Deviance[8]
df$dif[9] <- df$Deviance[8] - df$Deviance[9]
kable(df[,1:3],format = 'markdown')
1-pchisq(13.30-8.71,3)
125 + 116 + 94 + 100 + 106 + 14
sqrt(0.05*0.95/1000)
0.76/0.70
(0.76/0.70)
log((0.76/0.70)/((1-0.76)/(1-0.70))
)
log((0.76/0.70)/((1-0.76)/(1-0.70)))
log((0.914/0.88)/((1-0.914)/(1-0.88)))
log((0.959/0.95)/((1-0.959)/(1-0.95)))
log((0.76/0.24)/(0.70/0.3))
log((0.959/0.95)/((1-0.959)/(1-0.95)))
log((0.96/0.95)/((1-0.96)/(1-0.95)))
log((0.964/0.95)/((1-0.964)/(1-0.95)))
log((0.961/0.95)/((1-0.961)/(1-0.95)))
# Load libraries  -------------------------
library(ROCR)
library(knitr)     # kable
library(car)       # residualPlots
library(kableExtra)# Taules amb format
library(emmeans)   # Summary
library(gridExtra) # Varios gràfics ggplot en 1
library(ggplot2)   # Gràfics
library(pROC)      # Corba ROC
# library(jtools)    # summ --> Al final no s'utilitza
library(AER)       # dispersion.test
# library(pscl)      # zeroinfl
library(devtools)
library(glmmTMB)
library(multcomp)
library(data.table)
# devtools::install_github("rforge/countreg/pkg")
suppressMessages(library(countreg)) # zeroinfl
# Opcions knitr  -------------------------
options(knitr.kable.NA = '')                # NA com blancs a les taules
# Per poder modificar la grandaria de la font dels chunks
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
x <- def.chunk.hook(x, options)
ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
# Llegir les dades -------------------------
# https://github.com/proback/BeyondMLR/blob/master/data/ambiguity.csv
# https://bookdown.org/roback/bookdown-bysh/ch-poissonreg.html#open-ended-exercises-1
dades0 <- read.csv("ambiguity.csv") # read data
# Load libraries  -------------------------
library(ROCR)
library(knitr)     # kable
library(car)       # residualPlots
library(kableExtra)# Taules amb format
library(emmeans)   # Summary
library(gridExtra) # Varios gràfics ggplot en 1
library(ggplot2)   # Gràfics
library(pROC)      # Corba ROC
# library(jtools)    # summ --> Al final no s'utilitza
library(AER)       # dispersion.test
# library(pscl)      # zeroinfl
library(devtools)
library(glmmTMB)
library(multcomp)
library(data.table)
# devtools::install_github("rforge/countreg/pkg")
suppressMessages(library(countreg)) # zeroinfl
# Opcions knitr  -------------------------
options(knitr.kable.NA = '')                # NA com blancs a les taules
# Per poder modificar la grandaria de la font dels chunks
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
x <- def.chunk.hook(x, options)
ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
d <- data.frame(Gender=c('Boy','Boy','Boy','Girl','Girl','Girl'),
Food=c('Bottle-fed','Breast-fed','Supplement','Bottle-fed','Breast-fed','Supplement'),
Disease=c(77,47,19,48,31,16),
NonDisease=c(381,447,128,336,433,111))
kable(d,format='markdown',align = 'llrr')
kable(data.frame(Food=c('Bottle-fed','Breast-fed','Supplement','Total'),
Disease=c(125,78,35,238),NonDisease=c(842-125,958-78,274-35,2074-238),
Probabilitat=c(0.1485,0.0814,0.1277,0.1148)),format = "latex", booktabs = TRUE,col.names=c('b0 (intercept)','b1 (pendent)'), align='c') %>%
kable_styling(full_width = FALSE) %>%
column_spec(1, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(2, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(3, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(4, bold = T, width = "15em", border_right = T)
kable(data.frame(Food=c('Bottle-fed','Breast-fed','Supplement','Total'),
Disease=c('','','',238),NonDisease=c('','','',2074-238),Probabilitat=c('','','','')),format = "latex", booktabs = TRUE, align='c') %>%
kable_styling(full_width = FALSE) %>%
column_spec(1, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(2, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(3, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(4, bold = T, width = "15em", border_right = T)
kable(data.frame(Food=c('Bottle-fed','Breast-fed','Supplement','Total'),
Disease=c(125,78,35,238),NonDisease=c(842-125,958-78,274-35,2074-238),
Probabilitat=c(0.1485,0.0814,0.1277,0.1148)),format = "latex", booktabs = TRUE, align='c') %>%
kable_styling(full_width = FALSE) %>%
column_spec(1, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(2, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(3, bold = T, width = "15em",border_left = T, border_right = T) %>%
column_spec(4, bold = T, width = "15em", border_right = T)
library(twitteR)
retweets("1140665752019771392", n=20)
library(twitteR)
install.packages("twitteR")
retweets("1140665752019771392", n=20)
library(twitteR)
retweets("1140665752019771392", n=20)
get_oauth_sig()
token <- Token2.0$new(
params = list(as_header=TRUE),
app = oauth_app("fun.with.twitter", "no.key", "no.secret"),
endpoint = oauth_endpoints("twitter"),
credentials = list(access_token = "AAAAAAAAAAAAAAAAAAA%3DAAAAAAAAAAAAAA"),
cache = FALSE
)
use_oauth_token(token)
library(httr)
token <- Token2.0$new(
params = list(as_header=TRUE),
app = oauth_app("fun.with.twitter", "no.key", "no.secret"),
endpoint = oauth_endpoints("twitter"),
credentials = list(access_token = "AAAAAAAAAAAAAAAAAAA%3DAAAAAAAAAAAAAA"),
cache = FALSE
)
use_oauth_token(token)
retweets("1140665752019771392", n=20)
setup_twitter_oauth("jordicortes314", "TW11amvisi")
install.packages("tidytext")
library(tidytext)
160/238
880/1836
# Load libraries  -------------------------
library(ROCR)
library(knitr)     # kable
library(car)       # residualPlots
library(kableExtra)# Taules amb format
library(emmeans)   # Summary
library(gridExtra) # Varios gràfics ggplot en 1
library(ggplot2)   # Gràfics
library(pROC)      # Corba ROC
# library(jtools)    # summ --> Al final no s'utilitza
library(AER)       # dispersion.test
# library(pscl)      # zeroinfl
library(devtools)
library(glmmTMB)
library(multcomp)
library(data.table)
# devtools::install_github("rforge/countreg/pkg")
suppressMessages(library(countreg)) # zeroinfl
# Opcions knitr  -------------------------
options(knitr.kable.NA = '')                # NA com blancs a les taules
knitr::opts_chunk$set(echo=FALSE)
# Per poder modificar la grandaria de la font dels chunks
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
x <- def.chunk.hook(x, options)
ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
dades <- read.table('dades_02.txt',header=TRUE,sep='\t')
mod.pois <- glm(y~visites_prev*sexe+FEV,dades,family=poisson)
mod.qpois <- glm(y~visites_prev*sexe+FEV,dades,family=quasipoisson)
mod.nb0 <- glmmTMB(y~visites_prev*sexe+FEV, data=dades,
zi=~visites_prev*sexe+FEV,family=poisson)
mod.nb <- glmmTMB(y~visites_prev*sexe+FEV, data=dades,
zi=~visites_prev*sexe+FEV,family=nbinom2)
dades <- read.table('dades_02.txt',header=TRUE,sep='\t')
mod.pois <- glm(y~visites_prev*sexe+FEV,dades,family=poisson)
mod.qpois <- glm(y~visites_prev*sexe+FEV,dades,family=quasipoisson)
mod.nb0 <- glm.nb(y~visites_prev*sexe+FEV,dades)
mod.nb <- glm(y~visites_prev*sexe+FEV,dades,family=negative.binomial(theta=mod.nb0$theta))
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV, data=dades,
zi=~visites_prev*sexe+FEV,family=poisson)
mod.zinb <- glmmTMB(y~visites_prev*sexe+FEV, data=dades,
zi=~visites_prev*sexe+FEV,family=nbinom2)
mod.pois <- glm(y~visites_prev*sexe+FEV + offset(log(time)),dades,family=poisson)
dades
mod.pois <- glm(y~visites_prev*sexe + FEV + offset(log(temps)),dades,family=poisson)
mod.qpois <- glm(y~visites_prev*sexe+FEV+ offset(log(temps)),dades,family=quasipoisson)
mod.nb0 <- glm.nb(y~visites_prev*sexe+FEV,dades)
dades <- read.table('dades_02.txt',header=TRUE,sep='\t', stringsAsFactors = TRUE)
mod.pois <- glm(y~visites_prev*sexe + FEV + offset(log(temps)),dades,family=poisson)
mod.qpois <- glm(y~visites_prev*sexe+FEV+ offset(log(temps)),dades,family=quasipoisson)
mod.nb0 <- glm.nb(y~visites_prev*sexe+FEV+ offset(log(temps)),dades)
mod.nb <- glm(y~visites_prev*sexe+FEV+ offset(log(temps)),dades,family=negative.binomial(theta=mod.nb0$theta))
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV+ offset(log(temps)), data=dades,
zi=~visites_prev+sexe+FEV,dades,family=poisson)
mod.pois <- glm(y~visites_prev*sexe + FEV + offset(log(temps)),dades,family=poisson)
mod.qpois <- glm(y~visites_prev*sexe+FEV+ offset(log(temps)),dades,family=quasipoisson)
mod.nb0 <- glm.nb(y~visites_prev*sexe+FEV+ offset(log(temps)),dades)
mod.nb <- glm(y~visites_prev*sexe+FEV+ offset(log(temps)),dades,family=negative.binomial(theta=mod.nb0$theta))
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV+ offset(log(temps)), data=dades,
zi=~visites_prev+sexe+FEV,dades,family=poisson)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV+ , data=dades,offset=log(temps),
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps),
zi=~visites_prev+sexe+FEV,dades,family=poisson)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps),
zi=~visites_prev*sexe+FEV,dades,family=poisson)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,#offset=log(temps),
zi=~visites_prev*sexe+FEV,dades,family=poisson)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,#offset=log(temps),
zi=~visites_prev*sexe+FEV,family=poisson)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps),
zi=~visites_prev*sexe+FEV,family=poisson)
mod.zinb <- glmmTMB(y~visites_prev*sexe+FEV, data=dades,offset=log(temps),
zi=~visites_prev*sexe+FEV,family=nbinom2)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps),
zi=~sexe,family=poisson)
summary(mod.zip)
log(temps)
dades$temps
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps/30),
zi=~sexe,family=poisson)
summary(mod.zip)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps/30),
zi=~age,family=poisson)
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps/30),
zi=~edat,family=poisson)
summary(mod.zip)
dades$y
dades <- read.table('dades_02.txt',header=TRUE,sep='\t', stringsAsFactors = TRUE)
dades$y <- NA
dades$y <- dades$n
mod.pois <- glm(y~visites_prev*sexe + FEV + offset(log(temps/30)),dades,family=poisson)
mod.qpois <- glm(y~visites_prev*sexe+FEV+ offset(log(temps/30)),dades,family=quasipoisson)
mod.nb0 <- glm.nb(y~visites_prev*sexe+FEV+ offset(log(temps/30)),dades)
mod.nb <- glm(y~visites_prev*sexe+FEV+ offset(log(temps/30)),dades,family=negative.binomial(theta=mod.nb0$theta))
mod.zip <- glmmTMB(y~visites_prev*sexe+FEV , data=dades,offset=log(temps/30),
zi=~edat,family=poisson)
mod.zinb <- glmmTMB(y~visites_prev*sexe+FEV, data=dades,offset=log(temps/30),
zi=~edat,family=nbinom2)
# summary(mod.zip)
summary(mod.zip)
mod.zinb <- glmmTMB(y~visites_prev*sexe+FEV+edat, data=dades,offset=log(temps/30),
zi=~edat,family=nbinom2)
summary(mod.zinb)
dispersiontest(mod.pois,trafo=1)
dispersiontest(mod.pois,trafo=2)
dispersiontest(mod.pois,trafo=1)
dispersiontest(mod.pois,trafo=2)
##################################################################################
#                    Power simulation composite endpoints
##################################################################################
#
#
#
#
##################################################################################
#
# Last update: 10/03/2020
#
# R version: R 3.6.1
#
# Authors: Jordi Cortes (jordi.cortes-martinez@upc.edu)
#
#
##################################################################################
#
# References:
#   - Gomez G. and Lagakos S. Statistical considerations when using a composite
#     endpoint for comparing treatment groups. Statistics in Medicine, 2013.
#
##################################################################################
rm(list=ls())
##################################################################################
# Load packages
##################################################################################
library(copula)
library(numDeriv)
library(reshape)
library(rootSolve)
library(data.table)
# library(etm)
# library(AHR) # C:\Users\jordi\Dropbox\Sample Size T2E\AHR package
##################################################################################
# Load functions and parameters
##################################################################################
path1 <- 'C:/Users/jcortes/Dropbox/Sample Size T2E/Simulations'
path2 <- 'C:/Users/jordi/Dropbox/Sample Size T2E/Simulations'
path3 <- '/home/admingrbio/jordic/Simulations'
try(setwd(path1),silent=TRUE)
try(setwd(path2),silent=TRUE)
try(setwd(path3),silent=TRUE)
source('functions.R')
source('functions_simulations.R')
source('functions_ARE.R')
source('parameters.R')
##################################################################################
# Load data
##################################################################################
load('data/HRs_2020-03-16.RData')
View(d)
COMBINED_HR
HRstar_function
rm(list=ls())
library(copula)
library(numDeriv)
library(rootSolve)
# library(eha)
library(ggplot2)
##-- Ruled out
lambdaC10_ <- function(t) hweibull(t,beta1,b10)
##-- Parameters
rho=0.7
beta1=beta_e1=1
beta2=beta_e2=1
HR1=HR_e1=0.9
HR2=HR_e2=0.6
p1=p0_e1=0.2
p2=p0_e2=0.2
case = 3
copula='Frank'
rho_type='Spearman'
source('C:/Users/jcortes/Dropbox/Sample Size T2E/Simulations/functions.R')
source('C:/Users/jcortes/Dropbox/Sample Size T2E/Simulations/functions_ARE.R')
ARE(rho0=rho, beta1=beta1, beta2=beta2, HR1=HR1, HR2=HR2, p1=p1, p2=p2, case = case, copula = copula, rhoType=rho_type)
##-- New
setwd('C:/Users/jcortes/Google Drive/CompARE package/CompARE-package/CompARE-package/R')
list_files0 <- list.files()
list_files <- list_files0[grepl('\\.R',list_files0)]
for(f in list_files) source(f)
# source('C:/Users/jcortes/Google Drive/CompARE package/CompARE-package/CompARE-package/R/ARE_tte.R')
# source('C:/Users/jcortes/Google Drive/CompARE package/CompARE-package/CompARE-package/R/ARE_tte_array.R')
# source('C:/Users/jcortes/Google Drive/CompARE package/CompARE-package/CompARE-package/R/check_PROBT1UNC_int.R')
ARE_tte(p0_e1=p1, p0_e2=p2, HR_e1=HR1, HR_e2=HR2, beta_e1=beta1, beta_e2=beta2, case = case, rho=rho, copula = copula, rho_type=rho_type)
subdivisions=1000
##-- Copula
copula0 <- CopulaSelection(copula,rho,rho_type)
which.copula <- copula0[[1]]
theta <- copula0[[2]]
dcopula <- get(paste0('d',copula))
